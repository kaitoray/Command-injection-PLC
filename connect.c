/* connect.c
it is used to connect PLC
*/
#define _WINSOCK_DEPRECATED_NO_WARNINGS
#define _CRT_NONSTDC_NO_WARNINGS
#define  _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <stdlib.h>
#include <winsock2.h>
#include <windows.h>     /* Note: winsock2.h has included windows.h */
#include <conio.h>  //Include keyboard listening function kbhit()
#include <time.h>
#include "reference.h"

SOCKET        HMI007;   /* defined in winsock2.h */
byte sendMessageStr[100]; /* message to be sent to server */
byte SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4;	/*session handle value*/
byte ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4;		/*connection ID*/
byte CIPCount1 = 0x01, CIPCount2 = 0x00;
char  recvBuffer[100], input=0;
int sendStatus, recvStatus, i;
void CrossTrack(void);
void ParallelTrack(void);
void InsideSpeedZero(void);
void InsideSpeedMid1(void);
void InsideSpeedMid2(void);
void InsideSpeedMax(void);
void OutsideSpeedZero(void);
void OutsideSpeedMid1(void);
void OutsideSpeedMid2(void);
void OutsideSpeedMax(void);


int main(void)
{
	WSADATA       wsa_data;           /* defined in winsock2.h */
	struct sockaddr_in HMI;     /* defined in winsock2.h */
	struct hostent     *host = NULL;  /* defined in winsock2.h */

	//double time_old, time_new, time_interval = 0;


	printf("======== Connect to PLC ========\n\n");

	/* Step 1: startup winsocket - this is for Windows only */
	/* in pair with WSACleanup()                    */
	if (WSAStartup(MAKEWORD(2, 2), &wsa_data) != 0)
	{
		puts("WSAStartup failed!");
		exit(1);
	}

	/* Step 2: Create socket and check it is successful */
	/* in pair with closesocket()               */
	HMI007 = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
	if (HMI007 == INVALID_SOCKET)
	{
		printf("Failed to create socket(): %d\n", WSAGetLastError());
		exit(1);
	}

	/* Step 3.1: Setup TCP Server Parameters */
	HMI.sin_family = AF_INET;
	HMI.sin_addr.s_addr = inet_addr(MY_SERVER_IP_ADDRESS); /* defined in tcpserverclient.h */
	HMI.sin_port = htons(MY_SERVER_PORT_NUMBER);           /* defined in tcpserverclient.h */

														   /* Step 3.2: Connect to the TCP Server */
	if (connect(HMI007, (struct sockaddr *)&HMI, sizeof(HMI)) == SOCKET_ERROR)
	{
		printf("connect() failed: %d\n", WSAGetLastError());
		exit(1);
	}

	/* Step 4: Listen */
	listen(HMI007, 8);
	/*preparation */

	// Register session
	byte Rgsession[] = { 0x65, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x44, 0x56, 0x41, 0x4e, 0x43, 0x45, 0x44, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00 };
	sendStatus = send(HMI007, Rgsession, 28, 0);
	// Receive session number
	recvStatus = recv(HMI007, recvBuffer, 128, 0);
	// Store session number
	SessionHandle1 = recvBuffer[4];
	SessionHandle2 = recvBuffer[5];
	SessionHandle3 = recvBuffer[6];
	SessionHandle4 = recvBuffer[7];
	recvBuffer[recvStatus] = 0x00; /* '\0' */

	//Ask for connection ID
	byte connetionmanager[] = {0x6f, 0x00, 0x40, 0x00, SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xb2, 0x00, 0x30, 0x00, 0x54, 0x02, 0x20, 0x06, 0x24, 0x01, 0x07, 0xc3, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x41, 0x52, 0x43, 0x48, 0x49, 0x45, 0x02, 0x00, 0x00, 0x00, 0x80, 0x84, 0x1e, 0x00, 0xfc, 0x43, 0x80, 0x84, 0x1e, 0x00, 0xfc, 0x43, 0xa3, 0x03, 0x01, 0x00, 0x20, 0x02, 0x24, 0x01 };
	sendStatus = send(HMI007, connetionmanager, 88, 0);
	// Receive session number
	recvStatus = recv(HMI007, recvBuffer, 128, 0);
	ConnectionID1 = recvBuffer[44];
	ConnectionID2 = recvBuffer[45];
	ConnectionID3 = recvBuffer[46];
	ConnectionID4 = recvBuffer[47];
	recvBuffer[recvStatus] = 0x00; /* '\0' */


	for (;;)
	{
		if (kbhit())				// if any input from the keyboard
		{
			input = getch();
			switch (input)
			{
			//change track to cross
			case 88: CrossTrack(); break;
			case 120: CrossTrack(); break;
			//change track to parallel
			case 90: ParallelTrack(); break;
			case 122: ParallelTrack(); break;
			//inside speed
			case 49: InsideSpeedZero(); break;
			case 50: InsideSpeedMid1(); break;
			case 51: InsideSpeedMid2(); break;
			case 52: InsideSpeedMax(); break;
			//outside speed
			case 54: OutsideSpeedZero(); break;
			case 55: OutsideSpeedMid1(); break;
			case 56: OutsideSpeedMid2(); break;
			case 57: OutsideSpeedMax(); break;


			default: break;
			}
		}
	
		
		
	}

	return 0;
}


// ask for session traffic
//0x65, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x44, 0x56, 0x41, 0x4e, 0x43, 0x45, 0x44, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00

//EN/IP packet sample
/*byte sendMessageStr[100] = {0x70, 0x00, 0x2b, 0x00, 0x00, 0x02, 0x02, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00,
0xa1, 0x00, 0x04, 0x00, 0x41, 0x01, 0x90, 0x02, 0xb1, 0x00, 0x17, 0x00, 0x80, 0x1a, 0x4d, 0x07,
0x91, 0x0b, 0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x31, 0x5f, 0x33, 0x00, 0xc1, 0x00,
0x01, 0x00, 0x01 };	*/

void CrossTrack(void)
{
	byte sendMessageStr1[] = { 0x70, 0x00,	/*Send Unit Data*/		0x2b, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x17, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x07, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x0b,	/*Data Size*/
		0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x36, 0x5f, 0x33, /*Turnout_6_3*/	0x00,		0xc1, 0x00, 0x01, 0x00, 0x01 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr1, 67, 0);
	CIPCount1++;
	Sleep(500);

	byte sendMessageStr2[] = { 0x70, 0x00,	/*Send Unit Data*/		0x2b, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x17, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x07, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x0b,	/*Data Size*/
		0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x36, 0x5f, 0x33, /*Turnout_6_3*/	0x00,		0xc1, 0x00, 0x01, 0x00, 0x00 /*Specific Data*/ };
	sendStatus = send(HMI007, sendMessageStr2, 67, 0);
	CIPCount1++;
	Sleep(2500);

	byte sendMessageStr3[] = { 0x70, 0x00,	/*Send Unit Data*/		0x2b, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x17, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x07, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x0b,	/*Data Size*/
		0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x36, 0x5f, 0x33, /*Turnout_6_3*/	0x00,		0xc1, 0x00, 0x01, 0x00, 0x00 /*Specific Data*/ };
	sendStatus = send(HMI007, sendMessageStr3, 67, 0);
	CIPCount1++;

}

void ParallelTrack(void)
{
	byte sendMessageStr1[] = { 0x70, 0x00,	/*Send Unit Data*/		0x2b, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x17, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x07, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x0b,	/*Data Size*/
		0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x36, 0x5f, 0x32, /*Turnout_6_2*/	0x00,		0xc1, 0x00, 0x01, 0x00, 0x01 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr1, 67, 0);
	CIPCount1++;
	Sleep(500);

	byte sendMessageStr2[] = { 0x70, 0x00,	/*Send Unit Data*/		0x2b, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x17, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x07, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x0b,	/*Data Size*/
		0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x36, 0x5f, 0x32, /*Turnout_6_2*/	0x00,		0xc1, 0x00, 0x01, 0x00, 0x00 /*Specific Data*/ };
	sendStatus = send(HMI007, sendMessageStr2, 67, 0);
	CIPCount1++;
	Sleep(2500);

	byte sendMessageStr3[] = { 0x70, 0x00,	/*Send Unit Data*/		0x2b, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x17, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x07, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x0b,	/*Data Size*/
		0x54, 0x75, 0x72, 0x6e, 0x6f, 0x75, 0x74, 0x5f, 0x36, 0x5f, 0x32, /*Turnout_6_2*/	0x00,		0xc1, 0x00, 0x01, 0x00, 0x00 /*Specific Data*/ };
	sendStatus = send(HMI007, sendMessageStr3, 67, 0);
	CIPCount1++;

}

void OutsideSpeedZero(void)
{	
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x31, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void OutsideSpeedMid1(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x31, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0xdd, 0x02, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void OutsideSpeedMid2(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x31, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0xba, 0x05, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void OutsideSpeedMax(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x31, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0x98, 0x08, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void InsideSpeedZero(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x32, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void InsideSpeedMid1(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x32, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0xdd, 0x02, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void InsideSpeedMid2(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x32, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0xba, 0x05, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}

void InsideSpeedMax(void)
{
	byte sendMessageStr[] = { 0x70, 0x00,	/*Send Unit Data*/		0x32, 0x00,/*data length*/		  SessionHandle1, SessionHandle2, SessionHandle3, SessionHandle4,  /*session handle*/
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa1, 0x00, 0x04, 0x00,
		ConnectionID1, ConnectionID2, ConnectionID3, ConnectionID4,	/*Connection ID*/	0xb1, 0x00,		0x1e, 0x00,	/*CIP length*/		CIPCount1, CIPCount2,	/*Sequence Count*/	 0x4d, /*Unknown service*/
		0x09, /*Request Path Size*/		0x91, /*ANSI Symbol Segment*/	 0x10,	/*Data Size*/
		0x54, 0x72, 0x61, 0x69, 0x6e, 0x5f, 0x53, 0x70, 0x65, 0x65, 0x64, 0x32, 0x5f, 0x54, 0x61, 0x67, /*Train_Speed1_Tag*/	0xc4, 0x00, 0x01, 0x00, 0x98, 0x08, 0x00, 0x00 /*Specific Data*/ };

	sendStatus = send(HMI007, sendMessageStr, 74, 0);
	CIPCount1++;

}